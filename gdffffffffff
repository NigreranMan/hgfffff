qlocal a1 = game:GetService("Players")
local b2 = game:GetService("ReplicatedStorage")
local c3 = game:GetService("UserInputService")
local d4 = game:GetService("Workspace")

local e5 = a1.LocalPlayer
local f6 = e5.Character or e5.CharacterAdded:Wait()
local g7 = f6:WaitForChild("Humanoid")
local h8 = f6:WaitForChild("HumanoidRootPart")

local collectingBonds = false
local bondCountGui = nil
local collectGui = nil

-- تحديث عداد الباوندات في الـ GUI
local function updateBondCount()
    if not bondCountGui then
        bondCountGui = Instance.new("ScreenGui")
        bondCountGui.Parent = e5:FindFirstChildOfClass("PlayerGui")

        local a29 = Instance.new("TextLabel")
        a29.Size = UDim2.new(0.2, 0, 0.05, 0)
        a29.Position = UDim2.new(0.4, 0, 0.05, 0)
        a29.BackgroundTransparency = 0.3
        a29.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        a29.TextColor3 = Color3.fromRGB(255, 255, 255)
        a29.TextScaled = true
        a29.Text = "Bonds: 0"
        a29.Parent = bondCountGui
    end

    local bondCount = 0
    for _, bond in pairs(d4.RuntimeItems:GetChildren()) do
        if bond:IsA("Model") and bond.Name == "Bond" then
            local distance = (h8.Position - bond.PrimaryPart.Position).Magnitude
            if distance <= 500 then
                bondCount = bondCount + 1
            end
        end
    end

    bondCountGui.TextLabel.Text = "Bonds: " .. bondCount
end

-- إنشاء أو تحديث الـ GUI الخاص بزر E
local function showCollectGui()
    if not collectGui then
        collectGui = Instance.new("ScreenGui")
        collectGui.Parent = e5:FindFirstChildOfClass("PlayerGui")

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.3, 0, 0.05, 0)
        label.Position = UDim2.new(0.35, 0, 0.5, 0)
        label.BackgroundTransparency = 0.3
        label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextScaled = true
        label.Text = "اضغط E لجمع الباوندات"
        label.Parent = collectGui
    end
end

-- إخفاء الـ GUI الخاص بزر E
local function hideCollectGui()
    if collectGui then
        collectGui:Destroy()
        collectGui = nil
    end
end

-- البحث عن جميع الباوندات داخل نطاق 500
local function getAllBonds()
    local bonds = {}
    for _, bond in pairs(d4.RuntimeItems:GetChildren()) do
        if bond:IsA("Model") and bond.Name == "Bond" then
            local distance = (h8.Position - bond.PrimaryPart.Position).Magnitude
            if distance <= 500 then
                table.insert(bonds, bond)
            end
        end
    end
    return bonds
end

-- تحريك اللاعب إلى نقطة الهدف بدون انتظار
local function moveTo(humanoid, targetPoint)
    humanoid:MoveTo(targetPoint)
end

-- تفعيل سكربت استلام الباوند
local function activateBond(bond)
    local args = {bond}
    b2.Packages.RemotePromise.Remotes.C_ActivateObject:FireServer(unpack(args))
    print("Bond collected!")
end

-- جمع جميع الباوندات القريبة بأقصى سرعة
local function collectAllBonds()
    if collectingBonds then return end
    collectingBonds = true

    hideCollectGui() -- ✅ إخفاء GUI "اضغط E لجمع الباوندات" فورًا

    local bonds = getAllBonds()
    if #bonds == 0 then
        print("No Bonds found!")
        collectingBonds = false
        return
    end

    for _, bond in ipairs(bonds) do
        moveTo(g7, bond.PrimaryPart.Position) -- ✅ التحرك فورًا بدون انتظار
        activateBond(bond) -- ✅ استلام الباوند فور الوصول
    end

    collectingBonds = false
end

-- تشغيل البحث المستمر عن الباوندات وإظهار GUI الـ E
task.spawn(function()
    while true do
        updateBondCount() -- تحديث العداد باستمرار

        local bonds = getAllBonds()
        if #bonds > 0 then
            showCollectGui()
        else
            hideCollectGui()
        end

        task.wait(1)
    end
end)

-- عند الضغط على E، يبدأ بجمع كل الباوندات القريبة
c3.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.E and not gameProcessed then
        collectAllBonds()
    end
end)
