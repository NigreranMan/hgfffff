local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

local collecting = false
local gui = nil
local countGui = nil
local bondsFolder = Workspace:WaitForChild("RuntimeItems")

-- âœ… **Ø¯Ø§Ù„Ø© `moveTo` Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ø³Ù„Ø§Ø³Ø© Ù†Ø­Ùˆ Ø§Ù„Ù‡Ø¯Ù**
local function moveTo(humanoid, targetPoint, andThen)
    local targetReached = false
    local connection

    -- Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù€ Humanoid Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    connection = humanoid.MoveToFinished:Connect(function(reached)
        targetReached = true
        connection:Disconnect()
        connection = nil
        if andThen then
            andThen(reached)
        end
    end)

    -- Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´ÙŠ
    humanoid:MoveTo(targetPoint)

    -- ØªØ´ØºÙŠÙ„ ÙÙŠ Ø«Ø±ÙŠØ¯ Ù…Ù†ÙØµÙ„ Ø­ØªÙ‰ Ù„Ø§ ÙŠÙˆÙ‚Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
    task.spawn(function()
        while not targetReached do
            if not (humanoid and humanoid.Parent) then
                break
            end
            if humanoid.WalkToPoint ~= targetPoint then
                break
            end
            humanoid:MoveTo(targetPoint) -- ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ù…Ø´ÙŠ
            task.wait(6) -- Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ÙƒÙ„ 6 Ø«ÙˆØ§Ù†Ù
        end

        if connection then
            connection:Disconnect()
            connection = nil
        end
    end)
end

-- ğŸ”µ **Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Highlight Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©**
local function highlightBonds()
    for _, bond in pairs(bondsFolder:GetChildren()) do
        if bond:IsA("Model") and bond:FindFirstChild("HumanoidRootPart") then
            if not bond:FindFirstChild("Highlight") then
                local highlight = Instance.new("Highlight")
                highlight.Parent = bond
                highlight.FillColor = Color3.fromRGB(255, 255, 0)
                highlight.FillTransparency = 0.7
                highlight.OutlineTransparency = 1
            end
        end
    end
end

-- ğŸ”µ **Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ GUI**
local function updateBondCountGUI()
    if not countGui then
        countGui = Instance.new("ScreenGui", player:FindFirstChildOfClass("PlayerGui"))
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.2, 0, 0.05, 0)
        label.Position = UDim2.new(0.4, 0, 0.05, 0)
        label.BackgroundTransparency = 0.5
        label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextScaled = true
        label.Text = "Bonds: 0"
        label.Parent = countGui
    end

    local bondCount = #bondsFolder:GetChildren()
    countGui.TextLabel.Text = "Bonds: " .. bondCount
end

-- ğŸ”µ **Ø¥ÙŠØ¬Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±**
local function findNearbyBonds()
    local nearbyBonds = {}

    for _, bond in pairs(bondsFolder:GetChildren()) do
        if bond:IsA("Model") and bond:FindFirstChild("HumanoidRootPart") then
            local distance = (humanoidRootPart.Position - bond.HumanoidRootPart.Position).Magnitude
            if distance <= 500 then
                table.insert(nearbyBonds, bond)
            end
        end
    end

    return nearbyBonds
end

-- ğŸ”µ **Ø¥Ø¸Ù‡Ø§Ø± GUI Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø§ÙˆÙ†Ø¯ Ù‚Ø±ÙŠØ¨**
local function showCollectGUI()
    if not gui then
        gui = Instance.new("ScreenGui", player:FindFirstChildOfClass("PlayerGui"))
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.4, 0, 0.1, 0)
        label.Position = UDim2.new(0.3, 0, 0.4, 0)
        label.BackgroundTransparency = 0.3
        label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextScaled = true
        label.Text = "ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø§ÙˆÙ†Ø¯ØŒ Ø§Ø¶ØºØ· E Ù„Ø¬Ù…Ø¹Ù‡"
        label.Parent = gui
    end
end

-- ğŸ”µ **Ø¥Ø®ÙØ§Ø¡ GUI**
local function hideCollectGUI()
    if gui then
        gui:Destroy()
        gui = nil
    end
end

-- ğŸ”µ **Ø§Ù„ØªØ­Ø±Ùƒ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯ Ø«Ù… Ø§Ø³ØªÙ„Ø§Ù…Ù‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… `moveTo`**
local function moveToAndCollect(bond)
    if collecting then return end
    collecting = true

    local bondPosition = bond.HumanoidRootPart.Position
    moveTo(humanoid, bondPosition, function(reached)
        if reached then
            local args = {
                [1] = bond
            }
            ReplicatedStorage:WaitForChild("Packages"):WaitForChild("RemotePromise"):WaitForChild("Remotes"):WaitForChild("C_ActivateObject"):FireServer(unpack(args))
            wait(0.5) -- ØªØ£Ø®ÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ
            collecting = false
        end
    end)
end

-- ğŸ”µ **Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø¹Ù† Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ GUI**
local function checkAndCollectBonds()
    while true do
        -- Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø¹Ù† Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©
        local nearbyBonds = findNearbyBonds()

        -- Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø§ÙˆÙ†Ø¯ØŒ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù€ GUI
        if #nearbyBonds > 0 and not gui then
            showCollectGUI()
        end

        -- Ø¥Ø°Ø§ Ø¶ØºØ· Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¹Ù„Ù‰ EØŒ ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª
        if UserInputService:IsKeyDown(Enum.KeyCode.E) then
            for _, bond in pairs(nearbyBonds) do
                moveToAndCollect(bond)
            end
        end

        -- ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ù€ GUI
        updateBondCountGUI()

        -- Ø§Ù†ØªØ¸Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        wait(1)
    end
end

-- Ø¨Ø¯Ø£ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø¹Ù† Ø§Ù„Ø¨Ø§ÙˆÙ†Ø¯Ø§Øª
task.spawn(checkAndCollectBonds)
